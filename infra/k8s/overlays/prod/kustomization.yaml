# Production Environment Overlay
# AI Incident Assistant - Production configuration with full resources
apiVersion: kustomize.config.k8s.io/v1beta1
kind: Kustomization

# Base reference
resources:
- ../../base

# Target namespace
namespace: prod

# Common labels for production environment
commonLabels:
  environment: production

# Replica counts for production (high availability)
replicas:
- count: 3
  name: backend
- count: 3
  name: frontend

# Resource patches for production environment (full resources)



# Ingress host patch for production
patches:
- patch: |-
    - op: replace
      path: /spec/template/spec/containers/0/resources/requests/cpu
      value: "100m"
    - op: replace
      path: /spec/template/spec/containers/0/resources/requests/memory
      value: "128Mi"
    - op: replace
      path: /spec/template/spec/containers/0/resources/limits/cpu
      value: "500m"
    - op: replace
      path: /spec/template/spec/containers/0/resources/limits/memory
      value: "512Mi"
  target:
    kind: Deployment
    name: backend
- patch: |-
    - op: replace
      path: /spec/template/spec/containers/0/resources/requests/cpu
      value: "50m"
    - op: replace
      path: /spec/template/spec/containers/0/resources/requests/memory
      value: "64Mi"
    - op: replace
      path: /spec/template/spec/containers/0/resources/limits/cpu
      value: "200m"
    - op: replace
      path: /spec/template/spec/containers/0/resources/limits/memory
      value: "256Mi"
  target:
    kind: Deployment
    name: frontend
- patch: |-
    - op: replace
      path: /spec/template/spec/containers/0/resources/requests/cpu
      value: "100m"
    - op: replace
      path: /spec/template/spec/containers/0/resources/requests/memory
      value: "256Mi"
    - op: replace
      path: /spec/template/spec/containers/0/resources/limits/cpu
      value: "500m"
    - op: replace
      path: /spec/template/spec/containers/0/resources/limits/memory
      value: "1Gi"
  target:
    kind: StatefulSet
    name: postgres
- patch: |-
    - op: replace
      path: /spec/rules/0
      value:
        host: prod.174.138.120.13.nip.io
        http:
          paths:
          - path: /api
            pathType: Prefix
            backend:
              service:
                name: backend
                port:
                  number: 3001
          - path: /
            pathType: Prefix
            backend:
              service:
                name: frontend
                port:
                  number: 80
  target:
    kind: Ingress
    name: ai-incident-assistant

# ConfigMap for production-specific configuration
configMapGenerator:
- behavior: merge
  literals:
  - NODE_ENV=production
  - LOG_LEVEL=warn
  - CORS_ORIGIN=https://your-domain.com
  - VITE_API_URL=
  name: backend-config

# Image tags (will be updated by CI/CD pipeline)
images:
- name: registry.digitalocean.com/ai-incident-assistant/backend
  newName: registry.digitalocean.com/ai-incident-assistant/backend
  newTag: b387808985929fb1fa92b32ed2c3a212a7884789
- name: registry.digitalocean.com/ai-incident-assistant/frontend
  newName: registry.digitalocean.com/ai-incident-assistant/frontend
  newTag: b387808985929fb1fa92b32ed2c3a212a7884789
