apiVersion: kustomize.config.k8s.io/v1beta1
kind: Kustomization

namespace: staging

resources:
  - namespace.yaml
  - ../../base
  - frontend-service-lb.yaml
  # Secrets managed manually in cluster:
  # - postgres-secret.yaml
  # - backend-secrets.yaml

labels:
  - pairs:
      environment: staging
      managed-by: argocd

images:
  - name: registry.digitalocean.com/ai-incident-assistant/backend
    newTag: staging-latest
  - name: registry.digitalocean.com/ai-incident-assistant/frontend
    newTag: staging-latest

configMapGenerator:
  - name: backend-config
    literals:
      - NODE_ENV=staging
      - PORT=3001
      - DATABASE_HOST=postgres
      - DATABASE_PORT=5432
      - DATABASE_NAME=incidents_db
      - DATABASE_USER=incidents_user
      - LOG_LEVEL=info

replicas:
  - name: backend
    count: 1
  - name: frontend
    count: 1
  - name: postgres
    count: 1


