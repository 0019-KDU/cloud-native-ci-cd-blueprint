# Staging Environment Overlay
# AI Incident Assistant - Staging configuration with moderate resources
apiVersion: kustomize.config.k8s.io/v1beta1
kind: Kustomization

# Base reference
resources:
- ../../base

# Target namespace
namespace: staging

# Common labels for staging environment
commonLabels:
  environment: staging

# Replica counts for staging (moderate HA)
replicas:
- count: 2
  name: backend
- count: 2
  name: frontend

# Resource patches for staging environment (moderate limits)


patches:
- patch: |-
    - op: replace
      path: /spec/template/spec/containers/0/resources/requests/cpu
      value: "75m"
    - op: replace
      path: /spec/template/spec/containers/0/resources/requests/memory
      value: "96Mi"
    - op: replace
      path: /spec/template/spec/containers/0/resources/limits/cpu
      value: "350m"
    - op: replace
      path: /spec/template/spec/containers/0/resources/limits/memory
      value: "384Mi"
  target:
    kind: Deployment
    name: backend
- patch: |-
    - op: replace
      path: /spec/template/spec/containers/0/resources/requests/cpu
      value: "40m"
    - op: replace
      path: /spec/template/spec/containers/0/resources/requests/memory
      value: "48Mi"
    - op: replace
      path: /spec/template/spec/containers/0/resources/limits/cpu
      value: "150m"
    - op: replace
      path: /spec/template/spec/containers/0/resources/limits/memory
      value: "192Mi"
  target:
    kind: Deployment
    name: frontend
- patch: |-
    - op: replace
      path: /spec/template/spec/containers/0/resources/requests/cpu
      value: "75m"
    - op: replace
      path: /spec/template/spec/containers/0/resources/requests/memory
      value: "192Mi"
    - op: replace
      path: /spec/template/spec/containers/0/resources/limits/cpu
      value: "375m"
    - op: replace
      path: /spec/template/spec/containers/0/resources/limits/memory
      value: "768Mi"
  target:
    kind: StatefulSet
    name: postgres

# ConfigMap for staging-specific configuration
configMapGenerator:
- behavior: merge
  literals:
  - NODE_ENV=staging
  - LOG_LEVEL=info
  - CORS_ORIGIN=*
  - VITE_API_URL=
  name: backend-config

# Image tags (will be updated by CI/CD pipeline)
images:
- name: registry.digitalocean.com/ai-incident-assistant/backend
  newName: registry.digitalocean.com/ai-incident-assistant/backend
  newTag: 3139206df37d0d6f7fe0ad39670824ff0b7c20fa
- name: registry.digitalocean.com/ai-incident-assistant/frontend
  newName: registry.digitalocean.com/ai-incident-assistant/frontend
  newTag: 3139206df37d0d6f7fe0ad39670824ff0b7c20fa
